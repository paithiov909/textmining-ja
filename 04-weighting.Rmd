# 単語頻度の重みづけ {#weighting}

## tidytextによる単語頻度の重みづけ

`tidytext::bind_tf_idf`を使うと単語頻度からTF-IDFを算出することができます。

```{r}
dat_count |>
  tidytext::bind_tf_idf(token, doc_id, n) |>
  dplyr::slice_head(n = 5)
```

tidytextにおけるTFとIDFは、RMeCabにおけるそれとは採用している計算式が異なるため、計算結果が異なります。TFはRMeCabでは生の索引語頻度（tfの場合）ですが、tidytextでは文書内での相対頻度になります。また、IDFはRMeCabでは対数の底が2であるのに対して、tidytextでは底が10であるなどの違いがあります。

## gibasaによる単語頻度の重みづけ

gibasaはRMeCabにおける単語頻度の重みづけを`tidytext::bind_tf_idf`と同様のスタイルでおこなうことができる関数`gibasa::bind_tf_idf2`を提供しています。

`bind_tf_idf2`はおおむねRMeCabの単語頻度の重みづけの挙動を再現していますが、細かな点が異なります。まず、gibasaは「コサイン正規化」がIDFの計算時のみにおこなわれるため、`norm=TRUE`にしてもRMeCabの計算結果とは一致しません。また、`IDF=idf3`時の計算結果はRMeCabとは一致しません（これはRMeCab側が間違った結果を返すためです）。

RMeCabは以下の単語頻度の重みづけをサポートしています（ただし、idf3は指定してもidf2になるため、実際には利用できません）。

- 局所的重み（TF）
  - tf（索引語頻度）
  - tf2（対数化索引語頻度）
  - tf3（２進重み）
- 大域的重み（IDF）
  - idf（文書頻度の逆数）
  - idf2（大域的IDF）
  - idf3（確率的IDF）
  - idf4（エントロピー）
- 正規化
  - norm（コサイン正規化）

gibasaはこれらの重みづけを再実装しています。ただし、`tf="tf"`はgibasaでは相対頻度になるため、RMeCabの`weight="tf*idf"`に相当する出力を得るには、たとえば次のように計算します。

```{r}
dat_count |>
  gibasa::bind_tf_idf2(token, doc_id, n) |>
  dplyr::mutate(
    tf_idf = n / idf
  ) |>
  dplyr::slice_head(n = 5)
```

なお、注意点として、RMeCabの単語を数える機能は、品詞情報（POS1とPOS2まで）を確認しながら単語を数えているようなので、ここでのように原形だけを見て数えた結果とは必ずしも一致しません。
